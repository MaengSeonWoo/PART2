<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.talk.app.mypage.mapper.ResumeMapper">

	<resultMap id="resumeMap" type="ResumeVO">
		<collection property="careers" javaType="ArrayList" column="resume_no" ofType="CareerVO" select="selectCareers"/>
		<collection property="licenses" javaType="ArrayList" column="resume_no" ofType="LicenseVO" select="selectLicenses"/>
		<collection property="edus" javaType="ArrayList" column="resume_no" ofType="EduVO" select="selectEdus"/>
	</resultMap>

	<select id="selectCareers" parameterType="int" resultType="CareerVO">
		SELECT career_no
				, work_place
				, role
				, resume_no
				, orders
				, career_start
				, career_end
		FROM careers
		WHERE resume_no = #{resumeNo}
		order by orders
	</select>
	
	<select id="selectLicenses" parameterType="int" resultType="LicenseVO">
		SELECT license_no
				, get_date
				, license_name
				, license_company
				, resume_no
				, orders
		WHERE resume_no = #{resumeNo}
		ORDER BY orders
	</select>
	
	<select id="selectEdus" parameterType="int" resultType="EduVO">
		SELECT edu_no
				, graduation
				, school
				, major
				, resume_no
				, orders
		WHERE resume_no = #{resumeNo}
		ORDER BY orders
	</select>


	<select id="selectResumeList" parameterType="String" resultType="ResumeVO">
		SELECT r.resume_title,
		    	r.create_date
		FROM resume r
		WHERE r.user_no = (
                                                select user_no
                                                from users
                                                where user_id = #{userId}
                        )
		ORDER BY r.create_date DESC
	</select>
	
	<select id="selectApplyResumeList" parameterType="String" resultType="ResumeVO">
		SELECT r.resume_title,
			    p.co_name,
			    ar.apply_date
		FROM apply_resume ar
		JOIN resume r 
		ON ar.resume_no = r.resume_no
		JOIN posting p 
		ON ar.posting_no = p.posting_no
		WHERE r.user_no = (
                                                select user_no
                                                from users
                                                where user_id = #{userId}
                        )
		ORDER BY ar.apply_date DESC
	</select>

	<select id="selectResumeByNo" resultMap="resumeMap" parameterType="int">
		SELECT resume_no
				, resume_title
				, resume_name
				, birth
				, addr
				, tel
				, email
				, produce
				, user_no
				, resume_img
		FROM resume
		WHERE resume_no = 1
	</select>



</mapper>